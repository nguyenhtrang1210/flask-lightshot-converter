<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File - Flask</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <span class="brand">Convert Link Lightshot</span>
        </div>
    </header>

    <!-- Upload Section -->
    <div class="upload-container">
        <h1> Chuy·ªÉn ƒë·ªïi link Lighshot online sang ·∫£nh offline </h1>

        <form id="upload-form" enctype="multipart/form-data">
            <label for="file-upload" class="drop-zone">
                <img src="{{ url_for('static', filename='images/upload-icon.png') }}" alt="Upload">
                <p id="drop-text">Drop your file .txt here to convert</p>
                <input type="file" name="file" id="file-upload" accept=".txt">
            </label>
            <p id="file-name" style="color: #007bff; font-weight: bold;"></p> <!-- Hi·ªÉn th·ªã t√™n file -->
            <button type="submit" class="upload-btn">Submit</button>
        </form>

        <!-- Hi·ªÉn th·ªã qu√° tr√¨nh x·ª≠ l√Ω -->
        <p id="processing-text" style="display: none; font-weight: bold; color: orange;">
            ‚è≥ ƒêang x·ª≠ l√Ω file...
        </p>

        <!-- K·∫øt qu·∫£ t·∫£i file -->
        <div id="upload-result"></div>

        <!-- N√∫t t·∫£i ·∫£nh ƒë√£ chuy·ªÉn ƒë·ªïi (·∫©n m·∫∑c ƒë·ªãnh) -->
        <a id="download-btn" href="/download" class="download-btn" download style="display: none; background: #007bff; color: white; padding: 10px 15px; border-radius: 5px; text-decoration: none; font-weight: bold;">
            üì• T·∫£i ·∫£nh ƒë√£ chuy·ªÉn ƒë·ªïi
        </a>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                let dropZone = document.querySelector(".drop-zone");
                let fileInput = document.getElementById("file-upload");
                let fileNameDisplay = document.getElementById("file-name");

                // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh khi k√©o file v√†o
                dropZone.addEventListener("dragover", function (event) {
                    event.preventDefault();
                    dropZone.style.border = "2px dashed #007bff"; // Th√™m hi·ªáu ·ª©ng khi k√©o v√†o
                });

                dropZone.addEventListener("dragleave", function () {
                    dropZone.style.border = "2px dashed #ccc"; // Tr·∫£ l·∫°i vi·ªÅn ban ƒë·∫ßu
                });

                dropZone.addEventListener("drop", function (event) {
                    event.preventDefault();
                    dropZone.style.border = "2px dashed #ccc"; // Tr·∫£ l·∫°i vi·ªÅn

                    if (event.dataTransfer.files.length > 0) {
                        let file = event.dataTransfer.files[0];

                        // Ki·ªÉm tra ƒë·ªãnh d·∫°ng file
                        if (!file.name.endsWith(".txt")) {
                            alert("Ch·ªâ ch·∫•p nh·∫≠n file ƒë·ªãnh d·∫°ng .txt!");
                            return;
                        }

                        // G√°n file v√†o input file
                        fileInput.files = event.dataTransfer.files;
                        fileNameDisplay.innerText = `üìÑ ${file.name}`; // Hi·ªÉn th·ªã t√™n file
                    }
                });

                // Khi ch·ªçn file b·∫±ng input, c≈©ng hi·ªÉn th·ªã t√™n file
                fileInput.addEventListener("change", function () {
                    if (fileInput.files.length > 0) {
                        fileNameDisplay.innerText = `üìÑ ${fileInput.files[0].name}`;
                    }
                });
            });

            document.getElementById("file-upload").addEventListener("change", function(event) {
                let fileInput = event.target;
                let fileNameDisplay = document.getElementById("file-name");
                let dropText = document.getElementById("drop-text");

                if (fileInput.files.length > 0) {
                    let file = fileInput.files[0];

                    if (!file.name.endsWith(".txt")) {
                        alert("Ch·ªâ ch·∫•p nh·∫≠n file ƒë·ªãnh d·∫°ng .txt!");
                        fileInput.value = "";
                        fileNameDisplay.innerHTML = "";
                        dropText.innerHTML = "Drop your file .txt here to convert";
                        return;
                    }

                    // Hi·ªÉn th·ªã t√™n file ƒë√£ ch·ªçn
                    fileNameDisplay.innerHTML = `<b>File ƒë√£ ch·ªçn: ${file.name}</b>`;
                    dropText.innerHTML = "File ƒë√£ t·∫£i l√™n!";
                }
            });

            document.getElementById("upload-form").addEventListener("submit", function(event) {
                event.preventDefault(); // NgƒÉn form t·∫£i l·∫°i trang

                let fileInput = document.getElementById("file-upload");
                let resultDiv = document.getElementById("upload-result");
                let processingText = document.getElementById("processing-text");
                let downloadButton = document.getElementById("download-btn");

                if (fileInput.files.length === 0) {
                    alert("Vui l√≤ng ch·ªçn m·ªôt file!");
                    return;
                }

                let file = fileInput.files[0];

                // Ki·ªÉm tra ƒë·ªãnh d·∫°ng file tr∆∞·ªõc khi g·ª≠i l√™n server
                if (!file.name.endsWith(".txt")) {
                    alert("Ch·ªâ ch·∫•p nh·∫≠n file ƒë·ªãnh d·∫°ng .txt!");
                    return;
                }

                let formData = new FormData();
                formData.append("file", file);

                // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng loading
                processingText.style.display = "block";
                resultDiv.innerHTML = "";
                downloadButton.style.display = "none"; // ·∫®n n√∫t t·∫£i ·∫£nh tr∆∞·ªõc khi x·ª≠ l√Ω

                fetch("/", {
                    method: "POST",
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    processingText.style.display = "none"; // ·∫®n loading
                    if (data.status === "success") {
                        resultDiv.innerHTML = `<p style="color: green; font-weight: bold;">‚úîÔ∏è ${data.message}</p>`;

                        // **Ch·ªâ hi·ªÉn th·ªã n√∫t t·∫£i ·∫£nh n·∫øu c√≥ "T·∫£i ·∫£nh th√†nh c√¥ng!"**
                        if (data.message.includes("T·∫£i ·∫£nh th√†nh c√¥ng")) {
                            downloadButton.style.display = "block"; // Hi·ªÉn th·ªã n√∫t t·∫£i file
                            startBlinking(downloadButton); // K√≠ch ho·∫°t hi·ªáu ·ª©ng nh·∫•p nh√°y
                        }
                    } else {
                        resultDiv.innerHTML = `<p style="color: red; font-weight: bold;">‚ùå ${data.message}</p>`;
                        downloadButton.style.display = "none";
                    }
                })
                .catch(error => {
                    console.error("L·ªói:", error);
                    resultDiv.innerHTML = `<p style="color: red; font-weight: bold;">L·ªói khi t·∫£i file!</p>`;
                });
            });

            // H√†m l√†m button nh·∫•p nh√°y li√™n t·ª•c
            function startBlinking(button) {
                let isVisible = true;
                setInterval(() => {
                    button.style.opacity = isVisible ? "1" : "0.5";
                    isVisible = !isVisible;
                }, 500);
            }
        </script>

        <p class="file-info">L∆∞u √Ω: ·∫¢nh ph·∫£i c√≥ ƒë·ªãnh d·∫°ng l√† .txt, trong file g·ªìm list c√°c link ·∫£nh, m·ªói link l√† 1 d√≤ng</p>

        <!-- Hi·ªÉn th·ªã file m·∫´u -->
        <div class="file-preview">
            <h3>N·ªôi dung file m·∫´u:</h3>
        </div>

        <!-- N√∫t t·∫£i file m·∫´u -->
        <a href="{{ url_for('static', filename='links.txt') }}" class="download-btn" download>
            üì• T·∫£i file m·∫´u tham kh·∫£o
        </a>

    </div>

</body>

<footer class="footer">
    Created by Trang
</footer>
</html>
